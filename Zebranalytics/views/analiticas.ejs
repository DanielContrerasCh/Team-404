<%- include('includes/head.ejs') %>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-2 min-vh-100">
          <button class="btn btn-light btn-lg" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
            <i class="bi bi-list"></i>
          </button>
        </div>
        <div class="col-md-9">
          <div class="container mt-5">
            <h2 class="mb-4">Analiticas</h2>
              <div class="container mt-5">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <select class="form-select" name="brand" id="brand" aria-label="Select brand">
                        <option selected>Selecciona una marca</option>
                        <option value="LUUNA">LUUNA</option>
                        <option value="NOOZ">NOOZ</option>
                        <option value="MAPPA">MAPPA</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <input type="date" class="form-control" placeholder="Fecha inicio">
                    </div>
                  </div>
                  <div class="col-auto d-flex align-items-center">
                    <span>a</span>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <input type="date" class="form-control" placeholder="Fecha fin">
                    </div>
                  </div>
                </div>
              </div>                    
          </div>                
          <table class="table">
            <thead>
              <tr>
              <th>Calificación</th>
              <th>Producto</th>
              <th>Promedio de Ventas del Ultimo Año</th>
              <th>Ventas del Ultimo Año</th>
              </tr>
            </thead>

            <tbody>
                <tr data-bs-toggle="collapse" data-bs-target="#row1" aria-expanded="false" aria-controls="row1">
                    <td><img src="/img/stars/review5.png" alt=""></td>
                    <td>LUUNA 1002</td>
                    <td>4.5/5</td>
                    <td>51</td>
                </tr>
                <tr id="row1" class="collapse">
                    <td colspan="5"> <!-- Update colspan to cover all columns -->
                        <div class="container">
                            <canvas class="myChart" id="myChart1"></canvas>
                            <!-- Unique ID for the first row -->
                        </div>                         
                    </td>
                </tr>
                
                
                
                  
                <tr data-bs-toggle="collapse" data-bs-target="#row2" aria-expanded="false" aria-controls="row2">
                    <td><img src="/img/stars/review5.png" alt=""></td>
                    <td>LUUNA 1001</td>
                    <td>3.6</td>
                    <td>63</td>
                </tr>
                <tr id="row2" class="collapse">
                    <td colspan="5"> <!-- Update colspan to cover all columns -->
                        <div class="container">
                            <canvas class="myChart" id="myChart2"></canvas>
                            <!-- Unique ID for the second row -->
                        </div>                         
                    </td>
                </tr>
                            
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <%- include('includes/sidebar.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!--CHART JS-->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
  // Default data for the chart
  const labels = ['Ene','Feb','Mar','Abr','May','Junio','Julio','Agost','Sept','Oct', 'Nov','Dec'];
  const defaultData = {
    labels: labels,
    datasets: [{
      label: 'Promedios del Ultimo Mes',
      backgroundColor: 'rgba(255, 99, 132, 0.2)',
      borderColor: 'rgba(255, 99, 132, 1)',
      borderWidth: 1,
      data: [0,1,4,5,5,3,1,1,3,4,5,5],
    }]
  };

  // Create the chart for each row
  const charts = [];
  document.querySelectorAll('.myChart').forEach((canvas, index) => {
    const ctx = canvas.getContext('2d');
    charts.push(new Chart(ctx, {
      type: 'line',
      data: defaultData,
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    }));
  });

  // Update chart data when a row is clicked
  document.querySelectorAll('[data-bs-toggle="collapse"]').forEach((row, index) => {
    row.addEventListener('click', function() {
      // Here you can fetch and set new data for the chart
      const newData = fetchDataForIndex(index);
      charts[index].data.datasets[0].data = newData;
      charts[index].update();
    });
  });

  // Function to fetch data for a specific row index (replace with your actual data fetching logic)
  function fetchDataForIndex(index) {
    // Example data fetching logic, replace this with your actual data fetching code
    switch (index) {
      case 0:
        return [0,1,4,5,5,3,1,1,3,4,5,5]; // Sample data for row 1
      case 1:
        return [1,2,3,4,5,4,3,2,1,0,1,2]; // Sample data for row 2
      // Add cases for other rows as needed
      default:
        return [];
    }
  }
});

    </script>
    
    <!--<script src="./includes/chart.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>
