<!DOCTYPE html>
<html lang="en">

<%- include('includes/head.ejs', {permisos: permisos}) %>
<%- include('includes/header.ejs') %>

        <div class="col-md-9 m-auto mt-5">
          <div class="container">
            <h2 class="mb-4">Reseñas</h2>
              <div class="container mt-5">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group mb-3">
                      <select class="form-select" name="brand" id="brand" aria-label="Select brand">
                        <option selected>Selecciona una marca</option>
                        <option value="LUUNA">LUUNA</option>
                        <option value="NOOZ">NOOZ</option>
                        <option value="MAPPA">MAPPA</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-2">

                    <div class="form-group">
                      <input type="date" class="form-control" placeholder="Fecha inicio">
                    </div>
                  </div>
                  <div class="col-auto d-flex align-items-center">
                    <span>a</span>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <input type="date" class="form-control" placeholder="Fecha fin">
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <button class="btn btn-secondary" type="button"> Buscar </button>
                    </div>
                  </div>
                </div>
              </div>                    
          </div>                
          <table class="table">
            <thead>
              <tr>
              <th>Calificación</th>
              <th>Titulo</th>
              <th>Comentario</th>
              <th>Producto</th>
              <th>Fecha</th>
              <th>Visibilidad</th>
              <th></th> 
            </tr>
          </thead>
          <tbody>

            <% for (let review of reviews) { %>
              <% 
                let imagenEstrellas = '';
                switch (review.Calificacion) {
                    case 1:
                        imagenEstrellas = 'review1.png';
                        break;
                    case 2:
                        imagenEstrellas = 'review2.png';
                        break;
                    case 3:
                        imagenEstrellas = 'review3.png';
                        break;
                    case 4:
                        imagenEstrellas = 'review4.png';
                        break;
                    case 5:
                        imagenEstrellas = 'review5.png';
                        break;
                    default:
                        imagenEstrellas = 'review0.png'; // En caso de que la calificación no esté en el rango esperado
                }
                %>
            <tr>
              <td><img src="/img/stars/<%= imagenEstrellas %>" alt=""></td>              
              <td><%= review.Titulo %> </td>
              <td><%= review.Opinion %></td>
              <td><%= review.ItemCode %></td>
              <td><%= review.FechaContestacion.toISOString().substring(0, 10) %></td>
             <td>              
              <button type="button" id="changeVisibilityBtn_<%= review.IDResena %>"
        class="btn color-toggle <%= review.Visibilidad == 1 ? 'btn-success' : 'btn-danger' %>"
        data-review-id="<%= review.IDResena %>" data-visible="<%= review.visible %>"
        aria-expanded="false" aria-controls="row2" onclick="
        var button = this;
        var reviewId = button.getAttribute('data-review-id');
        var isVisible = button.getAttribute('data-visible') === 'true';

        fetch(`/reviews/${reviewId}/change-visibility`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': '<%= csrfToken %>'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            isVisible = !isVisible; // Toggle visibility
            button.classList.toggle('btn-success', isVisible);
            button.classList.toggle('btn-danger', !isVisible);
            button.setAttribute('data-visible', isVisible);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    ">
    <i class="fas fa-eye"></i>
</button>

        
              <td>
                <button type="button" class="btn btn-light" data-bs-toggle="collapse" data-bs-target="#row1" aria-expanded="false" aria-controls="row1">
                  <i class="fa-solid fa-caret-down"></i>
                </button>
              </td>
            </tr>
            <tr id="row1" class="collapse">
              <td colspan="7">
                <!-- Text -->
                <div>
                  <b>Enviado por</b>
                  <p><%= review.CorreoComprador %></p>
                  <b>##PREGUNTA1##</b>
                  <p>RESPUESTA 1</p>
                  
                </div>
                <!-- Carousel -->
                <div id="carouselExampleSlidesOnly1" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-inner">
                    <div class="carousel-item active">
                      <img src="/img/wireframe.png" class="d-block w-100" alt="First slide">
                    </div>
                  </div>
                </div>                                
              </td>
            </tr>

           <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <%- include('includes/sidebar.ejs') %>           
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/c5614e6e6c.js" crossorigin="anonymous"></script>
</body>
</html>
